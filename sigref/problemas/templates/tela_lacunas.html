{% extends "cedepe/base.html" %}
{% block title %}Lacunas{% endblock %}

{% block extra_style %}
<style>
    /* Ajustes na barra de pesquisa e filtros */
    
    .input-group {
        width: 60%;
        height: 45px;
    }

    .form-select {
        width: 160px;
    }

    /* Estilo para os botões de ação -----------------------------------*/
    .btnAcao{
        width: 180px;
    }
    
    .btn-info {
    background-color: #0cbbdf;
    color: white;
    font-weight: bold;
    }

    .btn-info:hover {
    background-color: #109ab6;
    color: white;
    }

    .btn-danger {
    font-weight: bold;
    }

    /* Tabela de Lacunas ---------------------------------------------- */
    .table th, .table td {
        text-align: left;
        vertical-align: middle;
        font-size: 14px;
    }

    .table th {
        background-color: #003366;
        color: white;
        font-size: 17px;
        padding: 12px;
    }

    .table td {
        padding: 11px;
    }

</style>
{% endblock %}
{% block content %}

<div class="container mt-4">
    <h3>Lacunas ({{ Lacuna.count }})</h3>

    <div class="col-12">
        <div class="d-flex justify-content-between gap-2">
            <!-- Barra de pesquisa -->
            <div class="input-group" style="width: 50%;">
                <span class="input-group-text"><i class="fas fa-search"></i></span>
                <input type="text" class="form-control" placeholder="Pesquise por Escola ou Disciplina...">
            </div>
            
            <div class="d-flex gap-2">
                <!-- Filtros -->
                <select class="form-select" aria-label="Filtro Data">
                    <option selected>Data</option>
                    <option value="1">Última semana</option>
                    <option value="2">Último mês</option>
                    <option value="3">Último ano</option>
                </select>
                <select class="form-select" aria-label="Filtro Status">
                    <option selected>Status</option>
                    <option value="1">Concluido</option>
                    <option value="2">Em Andamento</option>
                    <option value="3">Pendente</option>
                </select>
            </div>

            <div class="d-flex gap-2">
                <!-- Botões de ação -->
                <button class="btnAcao btn btn-info">Atualizar Status</button> 
                <button class="btnAcao btn btn-danger">Apagar Lacunas</button> 
            </div>
        </div>

        <!-- Tabela de Lacunas -->
        <table class="table table-striped mt-2">
            <thead>
                <tr>
                    <th><input type="checkbox"></th>
                    <th class="text-start">Escola</th>
                    <th class="text-start">Disciplina</th>
                    <th class="text-start">Carga H.</th>
                    <th class="text-start">Data</th>
                    <th class="text-start">Status</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {% for lacuna in lacunas_page %}
                    <tr>
                        <td><input type="checkbox"></td>
                        <td class="text-start">{{ lacuna.escola.nome }}</td>
                        <td class="text-start">{{ lacuna.disciplina }}</td>
                        <td class="text-start">{{ lacuna.carga_horaria }}</td>
                        <td class="text-start">{{ lacuna.criado_em|date:"d/m/Y" }}</td>
                        <td>
                            <span class="badge {% if lacuna.status == 'P' %}bg-danger{% elif lacuna.status == 'R' %}bg-success{% else %}bg-warning{% endif %}">
                                {% if lacuna.status == 'P' %}Pendente{% elif lacuna.status == 'R' %}Resolvido{% else %}Em Andamento{% endif %}
                            </span>
                        </td>
                        <td>
                            <button class="btn btn-danger btn-sm">Excluir</button>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Paginação -->
    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center">
            {% if lacunas_page.has_previous %}
                <li class="page-item"><a class="page-link" href="?page=1">&laquo; Primeiro</a></li>
                <li class="page-item"><a class="page-link" href="?page={{ lacunas_page.previous_page_number }}">Anterior</a></li>
            {% endif %}
            {% for num in lacunas_page.paginator.page_range %}
                {% if lacunas_page.number == num %}
                    <li class="page-item active"><span class="page-link">{{ num }}</span></li>
                {% else %}
                    <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
                {% endif %}
            {% endfor %}
            {% if lacunas_page.has_next %}
                <li class="page-item"><a class="page-link" href="?page={{ lacunas_page.next_page_number }}">Próximo</a></li>
                <li class="page-item"><a class="page-link" href="?page={{ lacunas_page.paginator.num_pages }}">Último &raquo;</a></li>
            {% endif %}
        </ul>
    </nav>
</div>

<script>
    document.getElementById("search").addEventListener("input", function () {
        var filter = this.value.toLowerCase();
        var rows = document.getElementById("lacunasTable").getElementsByTagName("tr");

        for (var i = 0; i < rows.length; i++) {
            var cells = rows[i].getElementsByTagName("td");
            var schoolCell = cells[1].textContent.toLowerCase();
            var subjectCell = cells[2].textContent.toLowerCase();

            if (schoolCell.indexOf(filter) > -1 || subjectCell.indexOf(filter) > -1) {
                rows[i].style.display = "";
            } else {
                rows[i].style.display = "none";
            }
        }
    });
</script>


{% endblock %}