{% extends "cedepe/base.html" %}
{% load static custom_tags %}

{% block title %}Gerenciar {{ model_config.titulo }}{% endblock %}

{% block content %}
<div class="container-fluid px-4 vh-100">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="mb-2" style="color: #10295d">
      <i class="fas fa-{{ model_config.icone }} me-2"></i>{{ model_config.titulo }}
    </h1>
    
    {% if model_config.url_novo %}
    <a href="{% url model_config.url_novo %}" class="btn btn-success">
      <i class="bi bi-plus-circle"></i> Novo
    </a>
    {% endif %}
  </div>

  <!-- Filtro de busca -->
  <form method="GET" class="mb-4">
    <div class="input-group">
      <input type="text" name="q" value="{{ filter_query }}" class="form-control" placeholder="Pesquisar...">
      <button class="btn btn-outline-primary" type="submit">
        <i class="bi bi-search"></i> Buscar
      </button>
    </div>
  </form>

  <!-- Tabela de Itens -->
  <div class="card shadow-sm">
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-hover table-bordered">
          <thead class="table-light">
            <tr>
              {% for campo in model_config.campos %}
              <th>{{ campo }}</th>
              {% endfor %}
              {% if model_config.acoes %}
              <th>Ações</th>
              {% endif %}
            </tr>
          </thead>
          <tbody>
            {% for item in itens %}
            <tr>
              {% if model_type == 'monitoramentos' %}
                <td>{{ item.questionario.titulo }}</td>
                <td>{{ item.escola.nome }}</td>
                <td><span class="badge bg-{% if item.status == 'R' %}success{% elif item.status == 'U' %}danger{% else %}warning{% endif %}">
                  {{ item.get_status_display }}
                </span></td>
                <td>{{ item.data_envio|date:"d/m/Y H:i" }}</td>

              {% elif model_type == 'problemas' %}
                <td>{{ item.tipo_problema.descricao }}</td>
                <td>{{ item.gestor.escola.nome }}</td>
                <td><span class="badge bg-{% if item.prioridade == 'A' %}danger{% elif item.prioridade == 'M' %}warning{% else %}info{% endif %}">
                  {{ item.get_prioridade_display }}
                </span></td>
                <td><span class="badge bg-{% if item.status == 'R' %}success{% elif item.status == 'U' %}danger{% else %}warning{% endif %}">
                  {{ item.get_status_display }}
                </span></td>
                <td>{{ item.data_relato|date:"d/m/Y H:i" }}</td>

              {% elif model_type == 'questionarios' %}
                <td>{{ item.titulo }}</td>
                <td>{{ item.setor.hierarquia_completa }}</td>
                <td>{{ item.escolas_destino.all|join:", "|truncatechars:30 }}</td>
                <td>{{ item.data_criacao|date:"d/m/Y" }}</td>
              {% endif %}

              {% if model_config.acoes %}
              <td>
                <a href="#" class="btn btn-sm btn-primary">
                  <i class="bi bi-pencil"></i> Editar
                </a>
                <button class="btn btn-sm btn-danger">
                  <i class="bi bi-trash"></i> Excluir
                </button>
              </td>
              {% endif %}
            </tr>
            {% empty %}
            <tr>
              <td colspan="{{ model_config.campos|length|add:1 }}" class="text-center">
                Nenhum registro encontrado
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- Paginação -->
      {% include 'gerenciar/partials/paginacao.html' %}
    </div>
  </div>
</div>
{% endblock %}