document.addEventListener('DOMContentLoaded', function() {
    const quartoSelect = document.getElementById('id_quarto');
    const camaSelect = document.getElementById('id_cama');

    // Inicializa Select2
    $(quartoSelect).select2();
    $(camaSelect).select2();

    async function carregarCamas(quartoId) {
        if (!quartoId) {
            $(camaSelect).html('<option value="">Selecione um quarto primeiro</option>');
            $(camaSelect).prop('disabled', true).trigger('change');
            return;
        }

        try {
            const response = await fetch(`/reservas/camas_disponiveis/?quarto=${quartoId}`);
            const data = await response.json();
            
            let options = '<option value="">Selecione uma cama...</option>';
            data.camas.forEach(cama => {
                options += `<option value="${cama.id}">${cama.identificacao}</option>`;
            });
            
            $(camaSelect).html(options).prop('disabled', false).trigger('change');
            
        } catch (error) {
            console.error('Erro ao carregar camas:', error);
            $(camaSelect).html('<option value="">Erro ao carregar camas</option>');
        }
    }

    // Evento de mudança no select de quartos
    $(quartoSelect).on('change', function() {
        carregarCamas(this.value);
    });

    // Carrega camas inicialmente se já tiver quarto selecionado
    {% if quarto_selecionado %}
        carregarCamas("{{ quarto_selecionado }}");
    {% endif %}
});